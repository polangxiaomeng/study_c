> **ğŸ•åšå®¢ä¸»é¡µï¼šï¸[è‡ªä¿¡ä¸å­¤å•](https://blog.csdn.net/czh1592272237)**
>
> **ğŸ¬æ–‡ç« ä¸“æ ï¼š[Cè¯­è¨€](https://blog.csdn.net/czh1592272237/category_12209876.html)**
>
> **ğŸšä»£ç ä»“åº“ï¼š[ç ´æµªæ™“æ¢¦](https://gitee.com/polang-xiaomeng/study_c)**
>
> **ğŸ­æ¬¢è¿å…³æ³¨ï¼šæ¬¢è¿å¤§å®¶ç‚¹èµæ”¶è—+å…³æ³¨**

# é€šè®¯å½•â€”â€”æ–‡ä»¶ç‰ˆ

[toc]

---

# å‰è¨€

> åœ¨ä¹‹å‰çš„æ–‡ç« ï¼Œæˆ‘ä»¬å·²ç»å®Œæˆäº†é€šè®¯å½•çš„é™æ€ç‰ˆå’ŒåŠ¨æ€ç‰ˆï¼Œåœ¨æ­¤åŸºç¡€ä¸Šæˆ‘ä»¬æ¥ç»§ç»­å¯¹é€šè®¯å½•åŠ ä»¥å®Œå–„ã€‚

==**æ³¨ï¼šå¦‚æœå¤§å®¶å¯¹äºè¿™ç¯‡ã€Šé€šè®¯å½•â€”â€”æ–‡ä»¶ç‰ˆã€‹çœ‹çš„ä¸æ˜¯å¾ˆæ‡‚çš„è¯ï¼Œå¯ä»¥å…ˆçœ‹çœ‹æˆ‘ä¹‹å‰å†™çš„ã€Š[é€šè®¯å½•â€”â€”é™æ€ç‰ˆ](https://blog.csdn.net/czh1592272237/article/details/129774050?spm=1001.2014.3001.5501)ã€‹å’Œã€Š[é€šè®¯å½•â€”â€”åŠ¨æ€ç‰ˆ](https://blog.csdn.net/czh1592272237/article/details/129781883?spm=1001.2014.3001.5501)ã€‹ï¼Œè¿™æ ·å†æ¥çœ‹è¿™ç¯‡æ–‡ç« å°±ä¼šå¾ˆè½»æ¾ã€‚**==

# å¯¹åŠ¨æ€ç‰ˆçš„ä¿®æ”¹

> åœ¨åŠ¨æ€ç‰ˆçš„åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬éœ€è¦æŠŠé€šè®¯å½•é‡Œçš„ä¿¡æ¯åœ¨ç¨‹åºç»“æŸæ—¶å­˜åˆ°æ–‡ä»¶ä¸­ï¼Œå¹¶åœ¨ç¨‹åºå¼€å§‹æ—¶å°†æ–‡ä»¶ä¸­çš„ä¿¡æ¯å†æ¬¡åŠ è½½åˆ°dataæŒ‡å‘çš„ç©ºé—´ä¸­ã€‚è¿™æ ·é€šè¿‡å¯¹æ–‡ä»¶çš„æ“ä½œå°±å®ç°äº†å°†ä¿¡æ¯å­˜å‚¨åˆ°æ–‡ä»¶ä¸­è¿›è¡Œä¿å­˜ï¼Œå¹¶åœ¨é‡æ–°æ‰§è¡Œç¨‹åºæ—¶è¿˜èƒ½è¯»åˆ°ä¹‹å‰å­˜å…¥çš„ä¿¡æ¯ã€‚

## 1. åˆå§‹åŒ–å‡½æ•°çš„å®ç°


> åˆå§‹åŒ–å‡½æ•°æ˜¯åœ¨é™æ€ç‰ˆå’ŒåŠ¨æ€ç‰ˆå®ç°çš„åŸºç¡€ä¸Šï¼Œæ–°å¢äº†åŠ è½½æ–‡ä»¶åˆ°é€šè®¯å½•çš„æ“ä½œã€‚

- é¦–å…ˆä½¿ç”¨fopenå‡½æ•°ä»¥äºŒè¿›åˆ¶è¯»ï¼ˆrbï¼‰çš„å½¢å¼æ‰“å¼€æˆ‘ä»¬çš„æ–‡ä»¶ã€‚å¦‚æœæ‰“å¼€æˆåŠŸï¼Œfopenå‡½æ•°å°±ä¼šè¿”å›ä¸€ä¸ªFILE*ç±»å‹çš„æ–‡æœ¬ä¿¡æ¯åŒºçš„åœ°å€ï¼›å¦‚æœæ‰“å¼€å¤±è´¥ï¼Œåˆ™ä¼šè¿”å›NULLã€‚
- ç„¶åä½¿ç”¨freadå‡½æ•°æ¥ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®ã€‚ä¸€æ¬¡è¯»ä¸€ä¸ªPeoInfoç±»å‹çš„æ•°æ®åˆ°tmpä¸­ï¼Œè¯»å–æˆåŠŸæ—¶ï¼Œå°±ä¼šè¿”å›è¯»å–æ•°æ®çš„ä¸ªæ•°ï¼Œåœ¨è¿™é‡Œæ¯æ¬¡è¯»å–æˆåŠŸè¿”å›1ï¼Œå½“æ²¡æœ‰æ•°æ®å¯ä»¥è¯»å°±è¿”å›0ï¼Œæ‰€ä»¥è¿™é‡Œå¯ä»¥é€šè¿‡whileå¾ªç¯å°†æ•°æ®ä¸€æ¡ä¸€æ¡çš„è¯»å…¥åˆ°dataæŒ‡å‘çš„å†…å­˜ä¸­ã€‚
- æœ€åä½¿ç”¨fcloseå‡½æ•°å…³é—­æ–‡ä»¶ï¼Œå¹¶æŠŠæ–‡ä»¶æŒ‡é’ˆç½®ä¸ºNULLã€‚

```c
void LoadContact(Contact* pc)
{
	//æ‰“å¼€æ–‡ä»¶
	FILE* pf = fopen("test.dat", "rb");
	if (NULL == pf)
	{
		perror("LoadContact::fopen");
		return;
	}
	//è¯»æ–‡ä»¶
	PeopleInfo tmp = { 0 };
	while (fread(&tmp, sizeof(PeopleInfo), 1, pf))
	{
		CheckCapacity(pc);
		pc->data[pc->sz] = tmp;
		(pc->sz)++;
	}
	//å…³é—­æ–‡ä»¶
	fclose(pf);
	pf = NULL;
}

void InitContact(Contact* pc)
{
	pc->data = (PeopleInfo*)calloc(DEFAULT_SZ, sizeof(PeopleInfo));
	if (pc->data == NULL)
	{
		perror("InitContact::calloc");
		return;
	}
	pc->sz = 0;
	pc->capacity = DEFAULT_SZ;
	//åŠ è½½æ–‡ä»¶çš„ä¿¡æ¯åˆ°é€šè®¯å½•
	LoadContact(pc);
}
```


## 2. ä¿å­˜é€šè®¯å½•ä¿¡æ¯åˆ°æ–‡ä»¶

> åœ¨æˆ‘ä»¬å®Œæˆå¯¹çš„æ“ä½œæ—¶ï¼Œå°±å¯ä»¥åœ¨ç»“æŸç¨‹åºæ—¶å°†é€šè®¯å½•çš„ä¿¡æ¯ä¿å­˜åˆ°æ–‡ä»¶ä¸­ã€‚

- é¦–å…ˆä½¿ç”¨fopenå‡½æ•°ä»¥äºŒè¿›åˆ¶å†™ï¼ˆwbï¼‰çš„å½¢å¼æ‰“å¼€æˆ‘ä»¬çš„æ–‡ä»¶ã€‚å¦‚æœæ‰“å¼€æˆåŠŸï¼Œfopenå‡½æ•°å°±ä¼šè¿”å›ä¸€ä¸ªFILE*ç±»å‹çš„æ–‡æœ¬ä¿¡æ¯åŒºçš„åœ°å€ï¼›å¦‚æœæ‰“å¼€å¤±è´¥ï¼Œåˆ™ä¼šè¿”å›NULLã€‚
- ç„¶åä½¿ç”¨fwriteå‡½æ•°æ¥ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®ã€‚å¯ä»¥ä½¿ç”¨forå¾ªç¯å°†dataæŒ‡å‘ç©ºé—´çš„szä¸ªPeopleinfoç±»å‹æ•°æ®ä¸€æ¡ä¸€æ¡çš„å†™å…¥åˆ°æ–‡ä»¶ä¸­ã€‚
- æœ€åä½¿ç”¨fcloseå‡½æ•°å…³é—­æ–‡ä»¶ï¼Œå¹¶æŠŠæ–‡ä»¶æŒ‡é’ˆç½®ä¸ºNULLã€‚

```c
  void Save(Contact* pc)
{
	//æ‰“å¼€æ–‡ä»¶
	FILE* pf = fopen("test.dat", "wb");
	if (NULL == pf)
	{
		perror("Save::fopen");
		return;
	}
	//å†™æ–‡ä»¶
	int i = 0;
	for (i = 0; i < pc->sz; i++)
	{
		fwrite((pc->data) + i, sizeof(PeopleInfo), 1, pf);
	}
	//å…³é—­æ–‡ä»¶
	fclose(pf);
	pf = NULL;
	printf("ä¿å­˜æˆåŠŸ\n");
}
```

# å®Œæ•´æºç 

==tect.cæ–‡ä»¶==

```c
#define _CRT_SECURE_NO_WARNINGS 1

#include "contact.h"

enum Optition
{
	EXIT,
	ADD,
	DEL,
	SEARCH,
	MODIFY,
	SHOW,
	SORT
};

static void menu()
{
	printf("********************************\n");
	printf("***    1. add     2. del     ***\n");
	printf("***    3. search  4. modify  ***\n");
	printf("***    5. show    6. sort    ***\n");
	printf("***    0. exit               ***\n");
	printf("********************************\n");
}



int main()
{

	int input = 0;
	Contact con;
	//åˆå§‹åŒ–é€šè®¯å½•
	InitContact(&con);
	do
	{
		menu();
		printf("è¯·è¾“å…¥æ“ä½œé€‰é¡¹:>");
		scanf("%d", &input);
		switch (input)
		{
		case ADD:
			Add(&con);
			break;
		case DEL:
			Del(&con);
			break;
		case SEARCH:
			Search(&con);
			break;
		case MODIFY:
			Modify(&con);
			break;
		case SHOW:
			Show(&con);
			break;
		case SORT:
			Sort(&con);
			break;
		case EXIT:
			Save(&con);
			Destroy(&con);
			printf("é€€å‡ºé€šè®¯å½•\n");
			break;
		default:
			printf("é€‰æ‹©é”™è¯¯\n");
			break;
		}
	} while (input);

	return 0;
}
```

==contact.hæ–‡ä»¶==

```c
#pragma once

#include <stdio.h>
#include <string.h>
#include <stdlib.h>

#define MAX_NAME 20
#define MAX_SEX 5
#define MAX_TELE 12
#define MAX_ADDR 40
#define DEFAULT_SZ 3    //é»˜è®¤å¤§å°
#define INC_SZ 5    //æ‰©å®¹å¤§å°

//æè¿°ä¸€ä¸ªäººçš„ä¿¡æ¯
typedef struct PeopleInfo
{
	char name[MAX_NAME];
	char sex[MAX_SEX];
	int age;
	char tele[MAX_TELE];
	char addr[MAX_ADDR];
}PeopleInfo;

//é€šè®¯å½•
typedef struct Contact
{
	PeopleInfo* data;//dataæŒ‡å‘å­˜æ”¾æ•°æ®çš„ç©ºé—´
	int sz;//è®°å½•é€šè®¯å½•ä¸­æœ‰æ•ˆä¿¡æ¯çš„ä¸ªæ•°
	int capacity;//è®°å½•é€šè®¯å½•å½“å‰çš„å®¹é‡
}Contact;

//åˆå§‹åŒ–é€šè®¯å½•
void InitContact(Contact* pc);
//æ·»åŠ è”ç³»äººä¿¡æ¯
void Add(Contact* pc);
//åˆ é™¤è”ç³»äººä¿¡æ¯
void Del(Contact* pc);
//æ˜¾ç¤ºè”ç³»äººä¿¡æ¯
void Show(Contact* pc);
//æŸ¥æ‰¾è”ç³»äººä¿¡æ¯
void Search(const Contact* pc);
//ä¿®æ”¹è”ç³»äººä¿¡æ¯
void Modify(Contact* pc);
//æŒ‰åå­—æ’åºé€šè®¯å½•
void Sort(Contact* pc);
//é”€æ¯é€šè®¯å½•
void Destroy(Contact* pc);
//ä¿å­˜æ•°æ®åˆ°æ–‡ä»¶
void Save(Contact* pc);
```

==contact.cæ–‡ä»¶==

```c
#define _CRT_SECURE_NO_WARNINGS 1

#include "contact.h"

static int CheckCapacity(Contact* pc);

void LoadContact(Contact* pc)
{
	//æ‰“å¼€æ–‡ä»¶
	FILE* pf = fopen("test.dat", "rb");
	if (NULL == pf)
	{
		perror("LoadContact::fopen");
		return;
	}
	//è¯»æ–‡ä»¶
	PeopleInfo tmp = { 0 };
	while (fread(&tmp, sizeof(PeopleInfo), 1, pf))
	{
		CheckCapacity(pc);
		pc->data[pc->sz] = tmp;
		(pc->sz)++;
	}
	//å…³é—­æ–‡ä»¶
	fclose(pf);
	pf = NULL;
}

//æ–‡ä»¶ç‰ˆ
void InitContact(Contact* pc)
{
	pc->data = (PeopleInfo*)calloc(DEFAULT_SZ, sizeof(PeopleInfo));
	if (pc->data == NULL)
	{
		perror("InitContact::calloc");
		return;
	}
	pc->sz = 0;
	pc->capacity = DEFAULT_SZ;
	//åŠ è½½æ–‡ä»¶çš„ä¿¡æ¯åˆ°é€šè®¯å½•
	LoadContact(pc);
}

void Destroy(Contact* pc)
{
	free(pc->data);
	pc->data = NULL;
	pc->capacity = 0;
	pc->sz = 0;
	printf("é‡Šæ”¾å†…å­˜æˆåŠŸ\n");
}


static int CheckCapacity(Contact* pc)
{
	if (pc->sz == pc->capacity)
	{
		PeopleInfo* str = (PeopleInfo*)realloc(pc->data, (pc->capacity + INC_SZ) * sizeof(PeopleInfo));
		if (str != NULL)
		{
			pc->data = str;
			pc->capacity += INC_SZ;
		}
		else
		{
			printf("å†…å­˜ä¸è¶³ï¼Œé€šè®¯å½•æ‰©å®¹å¤±è´¥\n");
			return -1;
		}
		printf("é€šè®¯å½•æ‰©å®¹æˆåŠŸï¼Œå½“å‰å®¹é‡ä¸º%d\n", pc->capacity);
	}
	return 1;
}

void Add(Contact* pc)
{
	if (CheckCapacity(pc) == -1)
	{
		return;
	}
	printf("è¯·è¾“å…¥å§“å:>");
	scanf("%s", pc->data[pc->sz].name);
	printf("è¯·è¾“å…¥æ€§åˆ«:>");
	scanf("%s", pc->data[pc->sz].sex);
	printf("è¯·è¾“å…¥å¹´é¾„:>");
	scanf("%d", &(pc->data[pc->sz].age));
	printf("è¯·è¾“å…¥ç”µè¯å·:>");
	scanf("%s", pc->data[pc->sz].tele);
	printf("è¯·è¾“å…¥ä½å€:>");
	scanf("%s", pc->data[pc->sz].addr);
	pc->sz++;
	printf("æ·»åŠ æˆåŠŸ\n");
}

void Show(Contact* pc)
{
	if (pc->sz == 0)
	{
		printf("é€šè®¯å½•ä¸ºç©º\n");
		return;
	}
	printf("%-20s%-10s%-20s%-20s%-30s\n", "å§“å", "æ€§åˆ«", "å¹´é¾„", "ç”µè¯", "åœ°å€");
	for (int i = 0; i < pc->sz; i++)
	{
		printf("%-20s%-10s%-20d%-20s%-30s\n",
			pc->data[i].name, pc->data[i].sex,
			pc->data[i].age, pc->data[i].tele, pc->data[i].addr);
	}
}

//æŸ¥æ‰¾è”ç³»äººå§“å
static int Find(const Contact* pc, const char name[])
{
	int i = 0;
	for (i = 0; i < pc->sz; i++)
	{
		if (strcmp(name, pc->data[i].name) == 0)
		{
			return i;
		}
	}
	return -1;
}

void Del(Contact* pc)
{
	char name[MAX_NAME] = {0};
	int ret = 0, i = 0;
	printf("è¯·è¾“å…¥è¦åˆ é™¤äººçš„å§“å:>");
	scanf("%s", name);
	ret = Find(pc, name);
	if (ret == -1)
	{
		printf("åˆ é™¤å¤±è´¥ï¼Œè¯¥è”ç³»äººä¸å­˜åœ¨\n");
		return;
	}
	else
	{
		for (i = ret; i < pc->sz-1; i++)
		{
			pc->data[i] = pc->data[i + 1];
		}
		pc->sz--;
		printf("åˆ é™¤æˆåŠŸ\n");
	}
}


void Search(const Contact* pc)
{
	char name[MAX_NAME] = { 0 };
	int ret = 0;
	printf("è¯·è¾“å…¥è¦æŸ¥æ‰¾äººçš„åå­—:>");
	scanf("%s", name);
	ret = Find(pc, name);
	if (ret == -1)
	{
		printf("è¯¥è”ç³»äººä¸å­˜åœ¨\n");
		return;
	}
	else
	{
		printf("%-20s%-10s%-20s%-20s%-30s\n", "å§“å", "æ€§åˆ«", "å¹´é¾„", "ç”µè¯", "åœ°å€");
		printf("%-20s%-10s%-20d%-20s%-30s\n", pc->data[ret].name, pc->data[ret].sex,
			pc->data[ret].age, pc->data[ret].tele, pc->data[ret].addr);
	}
}

void Modify(Contact* pc)
{
	char name[MAX_NAME] = { 0 };
	int ret = 0;
	printf("è¯·è¾“å…¥è¦ä¿®æ”¹äººçš„å§“å:>");
	scanf("%s", name);
	ret = Find(pc, name);
	if (ret == -1)
	{
		printf("è¯¥è”ç³»äººä¸å­˜åœ¨\n");
		return;
	}
	else
	{
		printf("è¯·è¾“å…¥å§“å:>");
		scanf("%s", pc->data[ret].name);
		printf("è¯·è¾“å…¥æ€§åˆ«:>");
		scanf("%s", pc->data[ret].sex);
		printf("è¯·è¾“å…¥å¹´é¾„:>");
		scanf("%d", &(pc->data[ret].age));
		printf("è¯·è¾“å…¥ç”µè¯å·:>");
		scanf("%s", pc->data[ret].tele);
		printf("è¯·è¾“å…¥ä½å€:>");
		scanf("%s", pc->data[ret].addr);
		printf("ä¿®æ”¹æˆåŠŸ\n");
	}
}

int compare_name(const void* p1, const void* p2)
{
	return strcmp(((PeopleInfo*)p1)->name, ((PeopleInfo*)p2)->name);
}

void Sort(Contact* pc)
{
	qsort(pc->data, pc->sz, sizeof(PeopleInfo), compare_name);
	printf("æ’åºæˆåŠŸ\n");
}

void Save(Contact* pc)
{
	//æ‰“å¼€æ–‡ä»¶
	FILE* pf = fopen("test.dat", "wb");
	if (NULL == pf)
	{
		perror("Save::fopen");
		return;
	}
	//å†™æ–‡ä»¶
	int i = 0;
	for (i = 0; i < pc->sz; i++)
	{
		fwrite((pc->data) + i, sizeof(PeopleInfo), 1, pf);
	}
	//å…³é—­æ–‡ä»¶
	fclose(pf);
	pf = NULL;
	printf("ä¿å­˜æˆåŠŸ\n");
}
```

==åˆ°æ­¤ï¼Œå…³äºã€Šé€šè®¯å½•â€”â€”åŠ¨æ€ç‰ˆã€‹çš„å†…å®¹å°±ç»“æŸäº†
æ„Ÿè°¢å¤§å®¶çš„è§‚çœ‹
åˆ›ä½œä¸æ˜“ï¼Œå¦‚æœå¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œè¯·ä¸€é”®ä¸‰è¿
æ‚¨çš„æ”¯æŒå°±æ˜¯æˆ‘åˆ›ä½œæœ€å¤§çš„åŠ¨åŠ›ï¼ï¼ï¼==